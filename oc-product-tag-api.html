<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../oc-core-utils/oc-core-utils.html">

<!--
`oc-product-tag-api`
Element to consume the Ordercloud local product tag API
-->

<dom-module id="oc-product-tag-api">

	<template>
		<iron-ajax id="getTagsByOrganisation"></iron-ajax>
		<iron-ajax id="getTags"></iron-ajax>
		<iron-ajax id="getTagById"></iron-ajax>
		<iron-ajax id="getAvailableTags"></iron-ajax>
		<iron-ajax id="toggleEnabled"></iron-ajax>
		<iron-ajax id="createTag"></iron-ajax>
		<iron-ajax id="updateTag"></iron-ajax>
		<iron-ajax id="deleteTag"></iron-ajax>
	</template>

	<script>
		class OcProductTagApi extends Ordercloud.ApiMixin(Polymer.Element) {
			static get is() {
				return 'oc-product-tag-api';
			}

			static get behaviours() {
			}

			getTagsByOrganisation(organisationId) {
				this.$.getTagsByOrganisation.url = this._generateUrl("product/tag/organisation/" + organisationId);
				return this._generateRequest(this.$.getTagsByOrganisation);
			}

			getTags(type, criteria) {
				this.$.getTags.url = this._generateUrl('product/tag/type/' + type);
				this.$.getTags.params = {
					'page': criteria.page || 1,
					'pagesize': criteria.pageSize || 10,
					'showDisabled': criteria.showDisabled || false
				};
				return this._generateRequest(this.$.getTags);
			}

			getTagById(id) {
				this.$.getTagById.url = this._generateUrl(`product/tag/${id}`);
				return this._generateRequest(this.$.getTagById);
			}

			/**
			 * Return tags of a Product of an organisation
			 * @return {Promise}
			 */
			getAvailableTags() {
				this.$.getAvailableTags.url = this._generateUrl('/product/tag');
				return this._generateRequest(this.$.getAvailableTags);
			}


			/**
			 * Enables/Disables tag with the specified ID.
			 * @param {Number} id
			 * @param {Boolean} enabled
			 * @returns {Promise}
			 */
			toggleEnabled(id, enabled) {
				this.$.toggleEnabled.url = this._generateUrl('product/tag/' + id + '/change/' + (enabled ? 'enable' : 'disable'));
				this.$.toggleEnabled.method = "PUT";
				return this._generateRequest(this.$.toggleEnabled);
			}

			createTag(tag) {
				this.$.createTag.url = this._generateUrl('product/tag');
				this.$.createTag.method = "POST";
				this.$.createTag.contentType = "application/json";
				this.$.createTag.body = {
					name: tag.name,
					description: tag.description,
					shortDescription: tag.shortDescription,
					tagType: { name: tag.tagType },
					organisation: { id: tag.organisationId }
				};
				return this._generateRequest(this.$.createTag);
			}

			updateTag(tag) {
				this.$.updateTag.url = this._generateUrl('product/tag/' + tag.id);
				this.$.updateTag.method = "PUT";
				this.$.updateTag.contentType = "application/json";
				this.$.updateTag.body = {
					name: tag.name,
					description: tag.description,
					shortDescription: tag.shortDescription,
					position: tag.position
				};
				return this._generateRequest(this.$.updateTag);
			}

			/**
			 * Delete a tag
			 * @param {Number} id The ID of the tag to delete.
			 * @returns {Promise}
			 */
			deleteTag(id) {
				this.$.deleteTag.url = this._generateUrl('product/tag/' + id);
				this.$.deleteTag.method = "DELETE";
				return this._generateRequest(this.$.deleteTag);
			}
		}

		window.customElements.define(OcProductTagApi.is, OcProductTagApi);
	</script>

</dom-module>
